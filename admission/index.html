<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MABSS Registration Form</title>
    <!-- Include jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://res.cloudinary.com/dr7bzccrr/image/upload/v1765392119/favicon_s5hgzc.ico" type="image/x-icon">
    <style>
        /* Header & Navigation Styles from homepage.html */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .header {
            background-color: #0e7704;
            color: white;
            padding: 0.5rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .logo {
            height: 50px;
            width: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
            margin-right: 0.5rem;
        }
        
        .school-name {
            margin: 0;
            font-size: 1rem;
            white-space: nowrap;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .nav-menu {
            display: none;
            background-color: #0e7704;
            padding: 1rem;
        }
        
        .nav-menu.show {
            display: block;
        }
        
        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        
        .nav-item {
            margin: 0.5rem 0;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            font-weight: bold;
            padding: 0.5rem;
            display: block;
            border-radius: 4px;
        }
        
        @media (min-width: 768px) {
            .menu-toggle {
                display: none;
            }
            
            .nav-menu {
                display: block;
                padding: 0;
            }
            
            .nav-list {
                flex-direction: row;
            }
            
            .nav-item {
                margin: 0 0.5rem;
            }
            
            .school-name {
                font-size: 1.2rem;
            }
        }
        
        @media (min-width: 992px) {
            .school-name {
                font-size: 1.5rem;
            }
            
            .logo {
                height: 50px;
                width: 50px;
            }
        }

        /* Original Registration Form Styles */
        :root {
            --updf-blue: #020e04;
            --updf-gold: #248b0a;
            --light-blue: #e6f0fa;
            --dark-blue: #003366;
        }
        
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .registration-body {
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        .form-header {
            background: linear-gradient(135deg, var(--updf-blue), var(--dark-blue));
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .form-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--updf-gold);
        }
        
        .form-header h1 {
            margin: 0;
            font-size: 24px;
            text-transform: uppercase;
        }
        
        .form-header h2 {
            margin: 10px 0 0;
            font-size: 18px;
            font-weight: normal;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--light-blue);
            border-radius: 8px;
            border-left: 5px solid var(--updf-blue);
        }
        
        .form-section h3 {
            margin-top: 0;
            color: var(--updf-blue);
            border-bottom: 2px solid var(--updf-gold);
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }
        
        .form-col {
            flex: 1;
            min-width: 200px;
            padding: 0 10px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-blue);
        }
        
        input[type="text"],
        input[type="date"],
        input[type="tel"],
        input[type="email"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--updf-blue);
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 86, 179, 0.2);
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input, .checkbox-option input {
            margin-right: 8px;
        }
        
        .address-fields {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(to right, var(--updf-blue), var(--dark-blue));
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 200px;
        }
        
        button:hover {
            background: linear-gradient(to right, var(--dark-blue), var(--updf-blue));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        button.secondary {
            background: linear-gradient(to right, #666, #444);
        }
        
        button.secondary:hover {
            background: linear-gradient(to right, #444, #666);
        }
        
        .declaration {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-top: 30px;
        }
        
        .declaration label {
            display: flex;
            align-items: flex-start;
        }
        
        .declaration input {
            margin-right: 10px;
            margin-top: 5px;
        }
        
        .signature-fields {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .signature-field {
            flex: 1;
            min-width: 200px;
            margin: 10px;
        }
        
        .signature-line {
            border-bottom: 1px solid #333;
            margin-top: 40px;
            padding-bottom: 5px;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 18px;
            flex-direction: column;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--updf-blue);
            color: white;
            padding: 15px 25px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 1001;
            max-width: 300px;
        }
        
        @media (max-width: 768px) {
            .form-col {
                flex: 100%;
                margin-bottom: 15px;
            }
            
            .address-fields {
                grid-template-columns: 1fr;
            }
            
            .form-header h1 {
                font-size: 20px;
            }
            
            .form-header h2 {
                font-size: 16px;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 300px;
            }
            
            .notification {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }
        
        @media print {
            button {
                display: none;
            }
            
            .container {
                box-shadow: none;
            }
            
            .header {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar (Exact copy from homepage.html) -->
    <div class="header">
        <header>
            <div class="nav-container">
                <div class="logo-container">
                    <img src="https://res.cloudinary.com/dr7bzccrr/image/upload/v1765345018/logo_mabss_shjvhz.jpg" alt="logo mabss" class="logo">
                    <h1 class="school-name">Mbarara Army Boarding<br> Secondary School</h1>
                </div>
                <button class="menu-toggle" id="menuToggle">☰</button>
            </div>
            <nav class="nav-menu" id="mainNav">
                <ul class="nav-list">
                    <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="login.html" class="nav-link">Academics</a></li>
                    <li class="nav-item"><a href="sports.html" class="nav-link">Co-curricular Activities</a></li>
                    <li class="nav-item"><a href="welfare.html" class="nav-link">Welfare</a></li>
                    <li class="nav-item"><a href="services.html" class="nav-link">Services</a></li>
                    <li class="nav-item"><a href="gallery.html" class="nav-link">Gallery</a></li>
                    <li class="nav-item"><a href="contacts.html" class="nav-link">Contacts</a></li>
                </ul>
            </nav>
        </header>
    </div>

    <div class="container">
        <div class="form-header">
            <h1>MBARARA ARMY BOARDING SECONDARY SCHOOL</h1>
            <h2>LEARNERS EMIS/DOTSHULE REGISTRATION FORM</h2>
            <p style="font-size: 14px; margin-top: 10px; opacity: 0.9;">Fill the form and download as PDF</p>
        </div>
        
        <form id="registrationForm">
            <div class="form-section">
                <h3>(a) LEARNER'S PERSONAL INFORMATION</h3>
                
                <div class="form-group">
                    <label for="fullName">(i) FULL NAME</label>
                    <input type="text" id="fullName" name="fullName" required>
                </div>
                
                <div class="form-group">
                    <label>(i) PLACE OF BIRTH</label>
                    <div class="address-fields">
                        <div>
                            <label for="birthCountry">Country</label>
                            <input type="text" id="birthCountry" name="birthCountry" value="Uganda" required>
                        </div>
                        <div>
                            <label for="birthDistrict">District</label>
                            <input type="text" id="birthDistrict" name="birthDistrict" required>
                        </div>
                        <div>
                            <label for="birthSubcounty">Subcounty</label>
                            <input type="text" id="birthSubcounty" name="birthSubcounty" required>
                        </div>
                        <div>
                            <label for="birthCounty">County</label>
                            <input type="text" id="birthCounty" name="birthCounty" required>
                        </div>
                        <div>
                            <label for="birthParish">Parish</label>
                            <input type="text" id="birthParish" name="birthParish">
                        </div>
                        <div>
                            <label for="birthVillage">Village</label>
                            <input type="text" id="birthVillage" name="birthVillage">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="dob">(i) DATE OF BIRTH</label>
                            <input type="date" id="dob" name="dob" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>(iii) SEX</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="male" name="sex" value="Male" required>
                                    <label for="male">Male</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="female" name="sex" value="Female">
                                    <label for="female">Female</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>(iv) ADMISSION MODE</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="newTransactional" name="admissionMode" value="New Transactional" required>
                            <label for="newTransactional">New Transactional</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="newTransfer" name="admissionMode" value="New Transfer">
                            <label for="newTransfer">New Transfer</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="freshRegistration" name="admissionMode" value="Fresh Registration">
                            <label for="freshRegistration">Fresh Registration</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>(v) RESIDENCE TYPE</label>
                            <select id="residenceType" name="residenceType" required>
                                <option value="">Select...</option>
                                <option value="Day">Day</option>
                                <option value="Boarding">Boarding</option>
                                <option value="House">House</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>(vi) ORPHANAGE STATUS</label>
                            <select id="orphanageStatus" name="orphanageStatus" required>
                                <option value="">Select...</option>
                                <option value="None">Both Parents Alive</option>
                                <option value="Mother">Mother Only</option>
                                <option value="Father">Father Only</option>
                                <option value="Both">Both Parents Deceased</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="lin">(vii) LIN</label>
                            <input type="text" id="lin" name="lin">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="indexNo">(viii) INDEX NO</label>
                            <input type="text" id="indexNo" name="indexNo" placeholder="PLE">
                            <input type="text" id="indexNoUce" name="indexNoUce" placeholder="UCE" style="margin-top: 8px;">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="examYear">(ix) YEAR OF EXAM</label>
                            <input type="number" id="examYearPLE" name="examYearPLE" placeholder="year of sitting PLE" min="2000" max="2099">
                            <input type="number" id="examYearUCE" name="examYearUCE" placeholder="year of sitting UCE" min="2000" max="2099" style="margin-top: 8px;">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="linUace">(vii) LIN</label>
                            <input type="text" id="linUace" name="linUace">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="indexNoUace">(viii) INDEX NO</label>
                            <input type="text" id="indexNoUace" name="indexNoUace" placeholder="UACE">
                            <input type="text" id="combination" name="combination" placeholder="enter a combination" style="margin-top: 8px;">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="examYearUace">(ix) YEAR OF EXAM</label>
                            <input type="number" id="examYearUace" name="examYearUace" min="2000" max="2099">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>(b) LEARNER'S SPECIAL NEEDS INFORMATION</h3>
                
                <div class="form-group">
                    <label for="healthNeeds">(x) HEALTH NEEDS</label>
                    <textarea id="healthNeeds" name="healthNeeds" rows="3" placeholder="Describe any special health needs"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="talent">(xi) TALENT</label>
                    <textarea id="talent" name="talent" rows="3" placeholder="Describe learner's talents"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="practicalNeeds">(xii) PRACTICAL NEEDS</label>
                    <textarea id="practicalNeeds" name="practicalNeeds" rows="3" placeholder="Describe any practical needs"></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h3>(c) PARENT/GUARDIAN INFORMATION</h3>
                
                <div class="form-group">
                    <label>Relationship to Learner</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="parent" name="relationshipType" value="Parent" required>
                            <label for="parent">Parent</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="guardian" name="relationshipType" value="Guardian">
                            <label for="guardian">Guardian</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="pgName">NAMES</label>
                            <input type="text" id="pgName" name="pgName" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>SEX</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="pgMale" name="pgSex" value="Male" required>
                                    <label for="pgMale">Male</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="pgFemale" name="pgSex" value="Female">
                                    <label for="pgFemale">Female</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="pgRelationship">RELATIONSHIP TO LEARNER</label>
                            <input type="text" id="pgRelationship" name="pgRelationship" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="pgProfession">PROFESSION/OCCUPATION</label>
                            <input type="text" id="pgProfession" name="pgProfession" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="pgResidence">RESIDENCE</label>
                    <input type="text" id="pgResidence" name="pgResidence" required>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="pgContacts">CONTACTS</label>
                            <input type="tel" id="pgContacts" name="pgContacts" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="pgDistrict">DISTRICT</label>
                            <input type="text" id="pgDistrict" name="pgDistrict" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="pgNin">NIN (ID)</label>
                    <input type="text" id="pgNin" name="pgNin">
                </div>
            </div>
            
            <div class="declaration">
                <h3>DECLARATION</h3>
                <p>I hereby declare that the information provided above is true and accurate to the best of my knowledge. I understand that providing false information may lead to disqualification or dismissal.</p>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="declaration" id="declaration" required> I agree to the above declaration
                    </label>
                </div>
                
                <div class="signature-fields">
                    <div class="signature-field">
                        <label for="signatureName">SIGNATURE (Name)</label>
                        <input type="text" id="signatureName" name="signatureName" required>
                    </div>
                    <div class="signature-field">
                        <label for="date">DATE</label>
                        <input type="date" id="date" name="date" required>
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button type="button" id="downloadPdfBtn" class="primary">
                    <i class="fas fa-download"></i> DOWNLOAD AS PDF
                </button>
                <button type="button" id="clearFormBtn" class="secondary">
                    <i class="fas fa-eraser"></i> CLEAR FORM
                </button>
            </div>
        </form>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div>Generating PDF...</div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <div id="notificationMessage"></div>
    </div>
    
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        // Mobile menu toggle (from homepage.html)
        document.getElementById('menuToggle').addEventListener('click', function() {
            const nav = document.getElementById('mainNav');
            nav.classList.toggle('show');
        });

        // Global jsPDF variable
        const { jsPDF } = window.jspdf;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            document.getElementById('dob').max = today;
            
            // Download PDF Button
            document.getElementById('downloadPdfBtn').addEventListener('click', generatePDF);
            
            // Clear Form Button
            document.getElementById('clearFormBtn').addEventListener('click', clearForm);
            
            // Form validation function
            function validateForm() {
                const requiredFields = document.querySelectorAll('[required]');
                let isValid = true;
                
                requiredFields.forEach(field => {
                    if (field.type === 'checkbox') {
                        if (!field.checked) {
                            field.parentElement.style.color = 'red';
                            isValid = false;
                        } else {
                            field.parentElement.style.color = '';
                        }
                    } else if (field.type === 'radio') {
                        const radioName = field.name;
                        const radioGroup = document.querySelectorAll(`input[name="${radioName}"]:checked`);
                        if (radioGroup.length === 0) {
                            document.querySelector(`input[name="${radioName}"]`).parentElement.parentElement.style.border = '1px solid red';
                            isValid = false;
                        } else {
                            document.querySelector(`input[name="${radioName}"]`).parentElement.parentElement.style.border = '';
                        }
                    } else if (!field.value.trim()) {
                        field.style.borderColor = 'red';
                        isValid = false;
                    } else {
                        field.style.borderColor = '#ddd';
                    }
                });
                
                return isValid;
            }
            
            // Clear form function
            function clearForm() {
                if (confirm('Are you sure you want to clear all form data?')) {
                    document.getElementById('registrationForm').reset();
                    
                    // Reset specific fields
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('date').value = today;
                    document.getElementById('birthCountry').value = 'Uganda';
                    
                    // Clear border colors
                    document.querySelectorAll('input, select, textarea').forEach(field => {
                        field.style.borderColor = '#ddd';
                    });
                    
                    showNotification('Form cleared successfully!', 'success');
                }
            }
            
            // Show notification function
            function showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                const messageDiv = document.getElementById('notificationMessage');
                
                messageDiv.textContent = message;
                notification.style.display = 'block';
                notification.style.background = type === 'success' ? '#00b327' : 
                                               type === 'error' ? '#dc3545' : '#00b327';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            
            // Show/hide loading overlay
            function showLoading(show) {
                document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
            }
            
            // Get form data as an object
            function getFormData() {
                const form = document.getElementById('registrationForm');
                const formData = new FormData(form);
                const data = {};
                
                // Get all form values
                formData.forEach((value, key) => {
                    if (data[key]) {
                        if (Array.isArray(data[key])) {
                            data[key].push(value);
                        } else {
                            data[key] = [data[key], value];
                        }
                    } else {
                        data[key] = value;
                    }
                });
                
                // Get radio button values
                const sex = document.querySelector('input[name="sex"]:checked');
                const admissionMode = document.querySelector('input[name="admissionMode"]:checked');
                const relationshipType = document.querySelector('input[name="relationshipType"]:checked');
                const pgSex = document.querySelector('input[name="pgSex"]:checked');
                
                data.sex = sex ? sex.value : '';
                data.admissionMode = admissionMode ? admissionMode.value : '';
                data.relationshipType = relationshipType ? relationshipType.value : '';
                data.pgSex = pgSex ? pgSex.value : '';
                
                // Get checkbox value
                data.declaration = document.getElementById('declaration').checked;
                
                return data;
            }
            
            // Main PDF generation function
            async function generatePDF() {
                // Validate form
                if (!validateForm()) {
                    showNotification('Please fill in all required fields marked in red', 'error');
                    return;
                }
                
                showLoading(true);
                
                try {
                    // Get form data
                    const formData = getFormData();
                    
                    // Create PDF document
                    const doc = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });
                    
                    // Set font
                    doc.setFont("helvetica");
                    
                    // Add school header
                    doc.setFillColor(0, 179, 39); // UPDF blue
                    doc.rect(0, 0, 210, 30, 'F');
                    
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(18);
                    doc.setFont("helvetica", "bold");
                    doc.text("MBARARA ARMY BOARDING SECONDARY SCHOOL", 105, 12, { align: 'center' });
                    
                    doc.setFontSize(14);
                    doc.text("LEARNERS EMIS/DOTSHULE REGISTRATION FORM", 105, 20, { align: 'center' });
                    
                    doc.setFontSize(10);
                    doc.text("Filled Form - " + new Date().toLocaleDateString(), 105, 27, { align: 'center' });
                    
                    // Add gold line
                    doc.setDrawColor(36, 139, 10); // UPDF gold
                    doc.setLineWidth(1);
                    doc.line(10, 32, 200, 32);
                    
                    // Reset text color for content
                    doc.setTextColor(0, 0, 0);
                    
                    let yPosition = 40; // Start position for content
                    
                    // Add form data sections
                    
                    // Section 1: Learner's Personal Information
                    doc.setFontSize(12);
                    doc.setFont("helvetica", "bold");
                    doc.text("(a) LEARNER'S PERSONAL INFORMATION", 15, yPosition);
                    yPosition += 8;
                    
                    doc.setFont("helvetica", "normal");
                    doc.setFontSize(10);
                    
                    // Full Name
                    doc.text(`(i) FULL NAME: ${formData.fullName || ''}`, 20, yPosition);
                    yPosition += 7;
                    
                    // Place of Birth
                    doc.text(`(ii) PLACE OF BIRTH:`, 20, yPosition);
                    yPosition += 5;
                    doc.text(`   Country: ${formData.birthCountry || ''}`, 25, yPosition);
                    yPosition += 5;
                    doc.text(`   District: ${formData.birthDistrict || ''}`, 25, yPosition);
                    yPosition += 5;
                    doc.text(`   Subcounty: ${formData.birthSubcounty || ''}`, 25, yPosition);
                    yPosition += 5;
                    if (formData.birthCounty) {
                        doc.text(`   County: ${formData.birthCounty}`, 25, yPosition);
                        yPosition += 5;
                    }
                    if (formData.birthParish) {
                        doc.text(`   Parish: ${formData.birthParish}`, 25, yPosition);
                        yPosition += 5;
                    }
                    if (formData.birthVillage) {
                        doc.text(`   Village: ${formData.birthVillage}`, 25, yPosition);
                        yPosition += 5;
                    }
                    
                    // Date of Birth and Sex
                    doc.text(`(iii) DATE OF BIRTH: ${formData.dob || ''}`, 20, yPosition);
                    doc.text(`    SEX: ${formData.sex || ''}`, 120, yPosition);
                    yPosition += 7;
                    
                    // Admission Mode
                    doc.text(`(iv) ADMISSION MODE: ${formData.admissionMode || ''}`, 20, yPosition);
                    yPosition += 7;
                    
                    // Residence Type and Orphanage Status
                    doc.text(`(v) RESIDENCE TYPE: ${formData.residenceType || ''}`, 20, yPosition);
                    doc.text(`(vi) ORPHANAGE STATUS: ${formData.orphanageStatus || ''}`, 120, yPosition);
                    yPosition += 7;
                    
                    // LIN, Index No, Year of Exam (PLE/UCE)
                    doc.text(`(vii) LIN: ${formData.lin || ''}`, 20, yPosition);
                    yPosition += 7;
                    
                    const indexNoPLE = document.getElementById('indexNo').value || '';
                    const indexNoUCE = document.getElementById('indexNoUce').value || '';
                    const examYearPLE = document.getElementById('examYearPLE').value || '';
                    const examYearUCE = document.getElementById('examYearUCE').value || '';
                    
                    doc.text(`(viii) INDEX NO - PLE: ${indexNoPLE}`, 20, yPosition);
                    doc.text(`   UCE: ${indexNoUCE}`, 120, yPosition);
                    yPosition += 7;
                    
                    doc.text(`(ix) YEAR OF EXAM - PLE: ${examYearPLE}`, 20, yPosition);
                    doc.text(`   UCE: ${examYearUCE}`, 120, yPosition);
                    yPosition += 7;
                    
                    // UACE Section
                    const linUace = document.getElementById('linUace').value || '';
                    const indexNoUace = document.getElementById('indexNoUace').value || '';
                    const combination = document.getElementById('combination').value || '';
                    const examYearUace = document.getElementById('examYearUace').value || '';
                    
                    if (linUace || indexNoUace || combination || examYearUace) {
                        doc.text(`(For UACE) LIN: ${linUace}`, 20, yPosition);
                        yPosition += 7;
                        doc.text(`   INDEX NO: ${indexNoUace}`, 20, yPosition);
                        doc.text(`   COMBINATION: ${combination}`, 120, yPosition);
                        yPosition += 7;
                        doc.text(`   YEAR OF EXAM: ${examYearUace}`, 20, yPosition);
                        yPosition += 7;
                    }
                    
                    yPosition += 5;
                    
                    // Check if we need a new page
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Section 2: Special Needs Information
                    doc.setFont("helvetica", "bold");
                    doc.setFontSize(12);
                    doc.text("(b) LEARNER'S SPECIAL NEEDS INFORMATION", 15, yPosition);
                    yPosition += 8;
                    
                    doc.setFont("helvetica", "normal");
                    doc.setFontSize(10);
                    
                    if (formData.healthNeeds) {
                        doc.text(`(x) HEALTH NEEDS:`, 20, yPosition);
                        yPosition += 5;
                        const healthLines = doc.splitTextToSize(formData.healthNeeds, 170);
                        doc.text(healthLines, 25, yPosition);
                        yPosition += (healthLines.length * 5) + 3;
                    }
                    
                    if (formData.talent) {
                        doc.text(`(xi) TALENT:`, 20, yPosition);
                        yPosition += 5;
                        const talentLines = doc.splitTextToSize(formData.talent, 170);
                        doc.text(talentLines, 25, yPosition);
                        yPosition += (talentLines.length * 5) + 3;
                    }
                    
                    if (formData.practicalNeeds) {
                        doc.text(`(xii) PRACTICAL NEEDS:`, 20, yPosition);
                        yPosition += 5;
                        const practicalLines = doc.splitTextToSize(formData.practicalNeeds, 170);
                        doc.text(practicalLines, 25, yPosition);
                        yPosition += (practicalLines.length * 5) + 3;
                    }
                    
                    yPosition += 5;
                    
                    // Check if we need a new page
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Section 3: Parent/Guardian Information
                    doc.setFont("helvetica", "bold");
                    doc.setFontSize(12);
                    doc.text("(c) PARENT/GUARDIAN INFORMATION", 15, yPosition);
                    yPosition += 8;
                    
                    doc.setFont("helvetica", "normal");
                    doc.setFontSize(10);
                    
                    doc.text(`Relationship: ${formData.relationshipType || ''}`, 20, yPosition);
                    doc.text(`Sex: ${formData.pgSex || ''}`, 120, yPosition);
                    yPosition += 7;
                    
                    doc.text(`Names: ${formData.pgName || ''}`, 20, yPosition);
                    yPosition += 7;
                    
                    doc.text(`Relationship to Learner: ${formData.pgRelationship || ''}`, 20, yPosition);
                    doc.text(`Profession: ${formData.pgProfession || ''}`, 120, yPosition);
                    yPosition += 7;
                    
                    doc.text(`Residence: ${formData.pgResidence || ''}`, 20, yPosition);
                    yPosition += 7;
                    
                    doc.text(`Contacts: ${formData.pgContacts || ''}`, 20, yPosition);
                    doc.text(`District: ${formData.pgDistrict || ''}`, 120, yPosition);
                    yPosition += 7;
                    
                    if (formData.pgNin) {
                        doc.text(`NIN (ID): ${formData.pgNin}`, 20, yPosition);
                        yPosition += 7;
                    }
                    
                    yPosition += 5;
                    
                    // Check if we need a new page
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Declaration Section
                    doc.setFont("helvetica", "bold");
                    doc.setFontSize(12);
                    doc.text("DECLARATION", 15, yPosition);
                    yPosition += 8;
                    
                    doc.setFont("helvetica", "normal");
                    doc.setFontSize(10);
                    
                    const declarationText = "I hereby declare that the information provided above is true and accurate to the best of my knowledge. I understand that providing false information may lead to disqualification or dismissal.";
                    const declarationLines = doc.splitTextToSize(declarationText, 180);
                    doc.text(declarationLines, 20, yPosition);
                    yPosition += (declarationLines.length * 5) + 10;
                    
                    doc.text(`Agreed: ${formData.declaration ? 'YES' : 'NO'}`, 20, yPosition);
                    yPosition += 10;
                    
                    // Signature and Date
                    doc.setDrawColor(0, 0, 0);
                    doc.setLineWidth(0.5);
                    
                    // Signature line
                    doc.text("Signature:", 20, yPosition);
                    doc.line(50, yPosition - 2, 100, yPosition - 2);
                    doc.text(formData.signatureName || '', 55, yPosition - 3);
                    
                    // Date
                    doc.text("Date:", 120, yPosition);
                    doc.line(140, yPosition - 2, 180, yPosition - 2);
                    doc.text(formData.date || '', 145, yPosition - 3);
                    
                    yPosition += 15;
                    
                    // Footer
                    doc.setFontSize(8);
                    doc.setTextColor(100, 100, 100);
                    doc.text("Generated by MABSS Registration System", 105, 285, { align: 'center' });
                    doc.text("© 2025 Mbarara Army Boarding Secondary School", 105, 290, { align: 'center' });
                    
                    // Generate filename
                    const fileName = `MABSS_Registration_${formData.fullName || 'Form'}_${new Date().toISOString().slice(0,10)}.pdf`;
                    
                    // Save the PDF
                    doc.save(fileName);
                    
                    showLoading(false);
                    showNotification('PDF downloaded successfully!', 'success');
                    
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    showLoading(false);
                    showNotification('Error generating PDF. Please try again.', 'error');
                }
            }
        });
    </script>
</body>
</html>